<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turing Patterns Explorer</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1a1a2e;
    color: #333;
    min-height: 100vh;
}

.header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    padding: 25px 30px;
    text-align: center;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.header h1 { font-size: 2rem; margin-bottom: 5px; }
.header p { font-size: 0.95rem; opacity: 0.9; }

.container {
    display: flex;
    gap: 20px;
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.controls {
    width: 300px;
    flex-shrink: 0;
    background: #f8f9fa;
    border-radius: 15px;
    padding: 20px;
    overflow-y: auto;
    max-height: calc(100vh - 120px);
}

.controls::-webkit-scrollbar { width: 6px; }
.controls::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }

.section { margin-bottom: 20px; }

.section-title {
    font-size: 1rem;
    font-weight: 700;
    color: #764ba2;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 2px solid #e0e0e0;
}

.preset-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

.preset-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 10px 8px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
}

.preset-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
}

.color-swatches {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
}

.color-swatch {
    height: 35px;
    border-radius: 8px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: border-color 0.2s, transform 0.2s;
    position: relative;
}

.color-swatch:hover { transform: translateY(-2px); }
.color-swatch.active { border-color: #764ba2; }

.color-swatch span {
    position: absolute;
    bottom: -18px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.65rem;
    color: #666;
    white-space: nowrap;
}

.param-group { margin-bottom: 14px; }

.param-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    margin-bottom: 4px;
    color: #555;
}

.param-label .value { font-weight: 700; color: #764ba2; }

input[type="range"] {
    width: 100%;
    accent-color: #764ba2;
    cursor: pointer;
}

.param-space {
    width: 100%;
    height: 200px;
    border-radius: 8px;
    position: relative;
    cursor: crosshair;
    margin-top: 10px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
}

.param-space canvas {
    width: 100%;
    height: 100%;
    display: block;
}

.param-marker {
    width: 12px;
    height: 12px;
    background: white;
    border: 2px solid #333;
    border-radius: 50%;
    position: absolute;
    transform: translate(-50%, -50%);
    pointer-events: none;
    box-shadow: 0 0 5px rgba(0,0,0,0.4);
    z-index: 2;
}

.param-space-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: #888;
    margin-top: 4px;
}

.brush-preview {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 8px;
}

.brush-dot {
    background: #764ba2;
    border-radius: 50%;
    flex-shrink: 0;
}

.control-buttons { display: flex; flex-direction: column; gap: 8px; }

.ctrl-btn {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 700;
    color: white;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
}

.ctrl-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
}

.btn-play { background: #4CAF50; }
.btn-reset { background: #ff6b6b; }
.btn-clear { background: #feca57; color: #333; }
.btn-save { background: #48dbfb; }

.speed-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
}

.speed-btn {
    flex: 1;
    padding: 8px;
    border: 2px solid #764ba2;
    border-radius: 8px;
    background: transparent;
    color: #764ba2;
    cursor: pointer;
    font-weight: 700;
    font-size: 0.85rem;
    transition: all 0.2s;
}

.speed-btn.active {
    background: #764ba2;
    color: white;
}

.info-panel {
    background: #e8f4fd;
    border-left: 4px solid #48dbfb;
    border-radius: 0 8px 8px 0;
    padding: 12px;
    font-size: 0.8rem;
    color: #555;
    line-height: 1.5;
}

.canvas-container {
    flex: 1;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    background: #000;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
    min-height: 400px;
}

.canvas-container canvas {
    cursor: crosshair;
    max-width: 100%;
    max-height: calc(100vh - 160px);
    border-radius: 4px;
}

@media (max-width: 900px) {
    .container {
        flex-direction: column-reverse;
    }
    .controls {
        width: 100%;
        max-height: none;
    }
    .canvas-container canvas {
        max-height: 60vh;
    }
}
</style>
</head>
<body>

<div class="header">
    <h1>&#129427; Turing Patterns Explorer</h1>
    <p>Discover how nature creates spots, stripes, and spirals through reaction-diffusion</p>
</div>

<div class="container">
    <div class="controls">

        <div class="section">
            <div class="section-title">&#9881;&#65039; Pattern Presets</div>
            <div class="preset-grid">
                <button class="preset-btn" data-preset="spots">Spots</button>
                <button class="preset-btn" data-preset="stripes">Stripes</button>
                <button class="preset-btn" data-preset="maze">Maze</button>
                <button class="preset-btn" data-preset="spirals">Spirals</button>
                <button class="preset-btn" data-preset="coral">Coral</button>
                <button class="preset-btn" data-preset="waves">Waves</button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">&#127912; Color Schemes</div>
            <div class="color-swatches">
                <div class="color-swatch active" data-scheme="classic" style="background: linear-gradient(90deg, blue, red);"><span>Classic</span></div>
                <div class="color-swatch" data-scheme="grayscale" style="background: linear-gradient(90deg, black, white);"><span>Grayscale</span></div>
                <div class="color-swatch" data-scheme="ocean" style="background: linear-gradient(90deg, #001f3f, #00d2ff);"><span>Ocean</span></div>
                <div class="color-swatch" data-scheme="fire" style="background: linear-gradient(90deg, #ff0000, #ffff00);"><span>Fire</span></div>
                <div class="color-swatch" data-scheme="nature" style="background: linear-gradient(90deg, #1e3a1e, #90ee90);"><span>Nature</span></div>
                <div class="color-swatch" data-scheme="sunset" style="background: linear-gradient(90deg, #ff6b6b, #feca57);"><span>Sunset</span></div>
            </div>
        </div>

        <div class="section" style="margin-top: 30px;">
            <div class="section-title">&#128202; Parameters</div>

            <div class="param-group">
                <div class="param-label"><span>Feed Rate (F)</span><span class="value" id="fVal">0.055</span></div>
                <input type="range" id="feedRate" min="0.01" max="0.1" step="0.001" value="0.055">
            </div>

            <div class="param-group">
                <div class="param-label"><span>Kill Rate (K)</span><span class="value" id="kVal">0.062</span></div>
                <input type="range" id="killRate" min="0.01" max="0.1" step="0.001" value="0.062">
            </div>

            <div class="param-group">
                <div class="param-label"><span>Diffusion Rate A</span><span class="value" id="daVal">1.0</span></div>
                <input type="range" id="diffA" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>

            <div class="param-group">
                <div class="param-label"><span>Diffusion Rate B</span><span class="value" id="dbVal">0.5</span></div>
                <input type="range" id="diffB" min="0.1" max="1.0" step="0.05" value="0.5">
            </div>

            <div class="param-space" id="paramSpace">
                <canvas id="paramCanvas"></canvas>
                <div class="param-marker" id="paramMarker"></div>
            </div>
            <div class="param-space-labels">
                <span>F: 0.01</span><span>F/K Parameter Space</span><span>F: 0.1</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">&#128396;&#65039; Brush Size</div>
            <div class="param-group">
                <div class="param-label"><span>Size</span><span class="value" id="brushVal">15</span></div>
                <input type="range" id="brushSize" min="5" max="50" step="5" value="15">
            </div>
            <div class="brush-preview">
                <div class="brush-dot" id="brushDot" style="width:15px;height:15px;"></div>
                <span style="font-size:0.8rem;color:#888;">Preview</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">&#9199;&#65039; Controls</div>
            <div class="control-buttons">
                <button class="ctrl-btn btn-play" id="playBtn">&#9208; Pause</button>
                <div class="speed-buttons">
                    <button class="speed-btn" data-speed="0.5">0.5x</button>
                    <button class="speed-btn active" data-speed="1">1x</button>
                    <button class="speed-btn" data-speed="2">2x</button>
                </div>
                <button class="ctrl-btn btn-reset" id="resetBtn">Reset</button>
                <button class="ctrl-btn btn-clear" id="clearBtn">Clear</button>
                <button class="ctrl-btn btn-save" id="saveBtn">Save Image</button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">&#8505;&#65039; Info</div>
            <div class="info-panel">
                <p><strong>Turing Patterns</strong> arise from reaction-diffusion systems where two chemicals interact and diffuse at different rates. Alan Turing proposed this mechanism in 1952 to explain biological pattern formation.</p>
                <p style="margin-top:8px;">Click and drag on the canvas to paint chemical B and watch patterns emerge!</p>
            </div>
        </div>
    </div>

    <div class="canvas-container">
        <canvas id="simCanvas" width="800" height="800"></canvas>
    </div>
</div>

<script>
(() => {
    const W = 800, H = 800;
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');

    // Simulation state
    let F = 0.055, K = 0.062, dA = 1.0, dB = 0.5;
    let running = true;
    let speedMultiplier = 1;
    let brushRadius = 15;
    let colorScheme = 'classic';

    // Grid: flat Float32Arrays for performance
    let gridA = new Float32Array(W * H);
    let gridB = new Float32Array(W * H);
    let nextA = new Float32Array(W * H);
    let nextB = new Float32Array(W * H);

    // Color schemes
    const colorSchemes = {
        classic: (t) => [255 * t, 0, 255 * (1 - t)],
        grayscale: (t) => { const v = 255 * (1 - t); return [v, v, v]; },
        ocean: (t) => [30 * t, 31 + 100 * (1 - t), 255 * (1 - t)],
        fire: (t) => [255, 255 * t, 0],
        nature: (t) => [30 + 114 * (1 - t), 58 + 168 * (1 - t), 30 + 114 * (1 - t)],
        sunset: (t) => [255 - 50 * t, 107 + 95 * (1 - t), 107 + 80 * (1 - t)]
    };

    // Preset parameters
    const presets = {
        spots:   { F: 0.055, K: 0.062 },
        stripes: { F: 0.035, K: 0.065 },
        maze:    { F: 0.029, K: 0.057 },
        spirals: { F: 0.018, K: 0.051 },
        coral:   { F: 0.062, K: 0.061 },
        waves:   { F: 0.014, K: 0.054 }
    };

    // --- Initialization ---
    function initGrid() {
        gridA.fill(1);
        gridB.fill(0);
    }

    function addRandomPerturbations(count, radius) {
        for (let i = 0; i < count; i++) {
            const cx = Math.floor(Math.random() * W);
            const cy = Math.floor(Math.random() * H);
            fillCircleB(cx, cy, radius);
        }
    }

    function fillCircleB(cx, cy, r) {
        for (let dy = -r; dy <= r; dy++) {
            for (let dx = -r; dx <= r; dx++) {
                if (dx * dx + dy * dy <= r * r) {
                    const x = ((cx + dx) % W + W) % W;
                    const y = ((cy + dy) % H + H) % H;
                    gridB[y * W + x] = 1;
                }
            }
        }
    }

    function initPresetPattern(type) {
        initGrid();
        switch (type) {
            case 'spots':
            case 'coral':
                addRandomPerturbations(25, 15);
                break;
            case 'stripes':
                for (let y = 0; y < H; y += 40) {
                    for (let t = 0; t < 5; t++) {
                        const yy = (y + t) % H;
                        for (let x = 0; x < W; x++) {
                            gridB[yy * W + x] = 1;
                        }
                    }
                }
                break;
            case 'maze':
                for (let x = 0; x < W; x += 30) {
                    for (let y = 0; y < H; y++) {
                        gridB[y * W + (x % W)] = 1;
                    }
                }
                for (let y = 0; y < H; y += 30) {
                    for (let x = 0; x < W; x++) {
                        gridB[(y % H) * W + x] = 1;
                    }
                }
                break;
            case 'spirals':
                addRandomPerturbations(15, 10);
                break;
            case 'waves':
                for (let x = 0; x < W; x++) {
                    const offset = Math.sin(x / 40 * Math.PI * 2) * 20;
                    for (let y = 0; y < H; y++) {
                        if (Math.abs((y % 80) - 40 + offset) < 5) {
                            gridB[y * W + x] = 1;
                        }
                    }
                }
                break;
            default:
                addRandomPerturbations(20, 20);
        }
    }

    // --- Simulation ---
    function update() {
        const dt = 1.0;
        for (let y = 0; y < H; y++) {
            const yUp = y === 0 ? H - 1 : y - 1;
            const yDn = y === H - 1 ? 0 : y + 1;
            for (let x = 0; x < W; x++) {
                const xLt = x === 0 ? W - 1 : x - 1;
                const xRt = x === W - 1 ? 0 : x + 1;
                const idx = y * W + x;

                const a = gridA[idx];
                const b = gridB[idx];

                // 5-point Laplacian stencil
                const lapA = gridA[yUp * W + x] * 0.2
                           + gridA[yDn * W + x] * 0.2
                           + gridA[y * W + xLt] * 0.2
                           + gridA[y * W + xRt] * 0.2
                           + a * -0.8;

                const lapB = gridB[yUp * W + x] * 0.2
                           + gridB[yDn * W + x] * 0.2
                           + gridB[y * W + xLt] * 0.2
                           + gridB[y * W + xRt] * 0.2
                           + b * -0.8;

                const reaction = a * b * b;

                nextA[idx] = a + (dA * lapA - reaction + F * (1 - a)) * dt;
                nextB[idx] = b + (dB * lapB + reaction - (K + F) * b) * dt;

                // Clamp
                if (nextA[idx] < 0) nextA[idx] = 0;
                else if (nextA[idx] > 1) nextA[idx] = 1;
                if (nextB[idx] < 0) nextB[idx] = 0;
                else if (nextB[idx] > 1) nextB[idx] = 1;
            }
        }
        // Swap
        const tmpA = gridA; gridA = nextA; nextA = tmpA;
        const tmpB = gridB; gridB = nextB; nextB = tmpB;
    }

    // --- Rendering ---
    const imageData = ctx.createImageData(W, H);
    const pixels = imageData.data;

    function render() {
        const colorFn = colorSchemes[colorScheme];
        for (let i = 0; i < W * H; i++) {
            const a = gridA[i];
            const [r, g, b] = colorFn(a);
            const p = i * 4;
            pixels[p] = r;
            pixels[p + 1] = g;
            pixels[p + 2] = b;
            pixels[p + 3] = 255;
        }
        ctx.putImageData(imageData, 0, 0);
    }

    // --- Animation Loop ---
    function animate() {
        if (running) {
            const iters = speedMultiplier < 1 ? 1 : Math.round(speedMultiplier);
            for (let i = 0; i < iters; i++) {
                update();
            }
        }
        render();
        requestAnimationFrame(animate);
    }

    // For 0.5x speed, skip every other frame
    let frameCount = 0;
    function animateWithSpeed() {
        frameCount++;
        if (running) {
            if (speedMultiplier >= 1) {
                const iters = Math.round(speedMultiplier);
                for (let i = 0; i < iters; i++) update();
            } else {
                if (frameCount % 2 === 0) update();
            }
        }
        render();
        requestAnimationFrame(animateWithSpeed);
    }

    // --- Parameter Space Map ---
    const paramCanvas = document.getElementById('paramCanvas');
    const paramCtx = paramCanvas.getContext('2d');

    function drawParamSpace() {
        const w = 200, h = 200;
        paramCanvas.width = w;
        paramCanvas.height = h;
        const img = paramCtx.createImageData(w, h);
        for (let py = 0; py < h; py++) {
            for (let px = 0; px < w; px++) {
                const f = 0.01 + (px / w) * 0.09;
                const k = 0.01 + (py / h) * 0.09;
                // Color based on parameter regions
                const sum = f + k;
                const diff = Math.abs(f - k);
                const r = Math.min(255, Math.floor(sum * 2000));
                const g = Math.min(255, Math.floor(diff * 3000));
                const b = Math.min(255, Math.floor((0.15 - sum) * 3000));
                const idx = (py * w + px) * 4;
                img.data[idx] = Math.max(0, r);
                img.data[idx + 1] = Math.max(0, g);
                img.data[idx + 2] = Math.max(0, Math.min(255, b));
                img.data[idx + 3] = 255;
            }
        }
        paramCtx.putImageData(img, 0, 0);
    }

    function updateParamMarker() {
        const marker = document.getElementById('paramMarker');
        const pctX = (F - 0.01) / 0.09 * 100;
        const pctY = (K - 0.01) / 0.09 * 100;
        marker.style.left = pctX + '%';
        marker.style.top = pctY + '%';
    }

    // --- UI Bindings ---
    const feedSlider = document.getElementById('feedRate');
    const killSlider = document.getElementById('killRate');
    const diffASlider = document.getElementById('diffA');
    const diffBSlider = document.getElementById('diffB');
    const brushSlider = document.getElementById('brushSize');

    function updateSliderDisplays() {
        document.getElementById('fVal').textContent = F.toFixed(3);
        document.getElementById('kVal').textContent = K.toFixed(3);
        document.getElementById('daVal').textContent = dA.toFixed(1);
        document.getElementById('dbVal').textContent = dB.toFixed(1);
        document.getElementById('brushVal').textContent = brushRadius;
        feedSlider.value = F;
        killSlider.value = K;
        diffASlider.value = dA;
        diffBSlider.value = dB;
        brushSlider.value = brushRadius;
    }

    feedSlider.addEventListener('input', () => {
        F = parseFloat(feedSlider.value);
        document.getElementById('fVal').textContent = F.toFixed(3);
        updateParamMarker();
    });

    killSlider.addEventListener('input', () => {
        K = parseFloat(killSlider.value);
        document.getElementById('kVal').textContent = K.toFixed(3);
        updateParamMarker();
    });

    diffASlider.addEventListener('input', () => {
        dA = parseFloat(diffASlider.value);
        document.getElementById('daVal').textContent = dA.toFixed(1);
    });

    diffBSlider.addEventListener('input', () => {
        dB = parseFloat(diffBSlider.value);
        document.getElementById('dbVal').textContent = dB.toFixed(1);
    });

    brushSlider.addEventListener('input', () => {
        brushRadius = parseInt(brushSlider.value);
        document.getElementById('brushVal').textContent = brushRadius;
        const dot = document.getElementById('brushDot');
        dot.style.width = brushRadius + 'px';
        dot.style.height = brushRadius + 'px';
    });

    // Presets
    document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const preset = btn.dataset.preset;
            const p = presets[preset];
            F = p.F;
            K = p.K;
            updateSliderDisplays();
            updateParamMarker();
            initPresetPattern(preset);
        });
    });

    // Color schemes
    document.querySelectorAll('.color-swatch').forEach(swatch => {
        swatch.addEventListener('click', () => {
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            swatch.classList.add('active');
            colorScheme = swatch.dataset.scheme;
        });
    });

    // Parameter space click
    document.getElementById('paramSpace').addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width;
        const y = (e.clientY - rect.top) / rect.height;
        F = 0.01 + x * 0.09;
        K = 0.01 + y * 0.09;
        F = Math.max(0.01, Math.min(0.1, F));
        K = Math.max(0.01, Math.min(0.1, K));
        updateSliderDisplays();
        updateParamMarker();
        initGrid();
        addRandomPerturbations(20, 20);
    });

    // Play/Pause
    const playBtn = document.getElementById('playBtn');
    playBtn.addEventListener('click', () => {
        running = !running;
        playBtn.innerHTML = running ? '&#9208; Pause' : '&#9654; Play';
    });

    // Speed
    document.querySelectorAll('.speed-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            speedMultiplier = parseFloat(btn.dataset.speed);
        });
    });

    // Reset
    document.getElementById('resetBtn').addEventListener('click', () => {
        initGrid();
        addRandomPerturbations(20, 20);
    });

    // Clear
    document.getElementById('clearBtn').addEventListener('click', () => {
        initGrid();
    });

    // Save
    document.getElementById('saveBtn').addEventListener('click', () => {
        const link = document.createElement('a');
        link.download = 'turing-pattern.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });

    // --- Mouse/Touch Drawing ---
    let isDrawing = false;

    function getCanvasCoords(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = W / rect.width;
        const scaleY = H / rect.height;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: Math.floor((clientX - rect.left) * scaleX),
            y: Math.floor((clientY - rect.top) * scaleY)
        };
    }

    function draw(e) {
        if (!isDrawing) return;
        const { x, y } = getCanvasCoords(e);
        fillCircleB(x, y, brushRadius);
    }

    canvas.addEventListener('mousedown', (e) => { isDrawing = true; draw(e); });
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', () => { isDrawing = false; });
    canvas.addEventListener('mouseleave', () => { isDrawing = false; });

    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); isDrawing = true; draw(e); });
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
    canvas.addEventListener('touchend', () => { isDrawing = false; });

    // --- Start ---
    initGrid();
    addRandomPerturbations(20, 20);
    drawParamSpace();
    updateParamMarker();
    animateWithSpeed();
})();
</script>
</body>
</html>
